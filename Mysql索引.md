# 1.索引的数据结构
###### 1.索引概述
**索引的本质：** 索引是数据结构，可以理解为排好序的快速查找数据结构
索引是在存储引擎中实现的，在InnoDB中是B+树，同时存储引擎可以定义每个表的最大索引数和最大索引长度
###### 2.优点
1) 降低数据库的IO成本，这也是创建索引最主要的原因
2) 唯一索引，保证数据唯一性
3) 外键，加速表和表之间的连接，联合查询时可以提高查询效率
4) 在使用分组和排序子句进行数据查询时，可以显著减少时间，降低CPU消耗，因为它是排好序的快速查找数据结构,排序就不用说了，分组的时候快是因为附近的元素如果有相同数值的，就能很快的分为一组，也是由于已经排好序了  
###### 3.缺点
1) 创建和维护索引需要耗费时间
2) 占磁盘空间
3) 降低表更新的速度，因为要动态维护索引,
```这种情况下，先删除表中的数据，然后插入数据后再创建索引```
---
# InnoDB中的索引方案
**B+树**  
![img_9.png](img_9.png)
最下面一层存放实际的记录。一般情况下，我们用到的B+树都不会超过4层，IO次数减少，时间减少很多，又因为每个页面有页目录，可以用二分法快速定位记录，一个数据页默认为16kb  
---
##### 常见索引概念

1. 聚簇索引   
```索引即数据，数据即索引```  
   ![img_9.png](img_9.png)
**特点**  
   1. 使用记录主键值的大小进行记录和页的排序
   * 页内的记录按主键大小顺序排成一个单向链表
   * 各个存放用户记录的页也是根据主键大小排成一个双向链表
   * 存放目录项记录的页分为不同的层次，在同一层次中的页也是根据页中目录项记录的主键大小排序排成一个双向链表
   2. B+树的叶子节点存储的是完整的用户记录   
![img_10.png](img_10.png)

**优点**
* 数据访问更快,因为索引和数据保存在同一B+树
* 查找速度快
* 节省大量IO操作  

**缺点**  
* 插入速度慢，要排序，所以一般都是采用自增ID为主键
* 更新主键得重新排序，所以一般定义为主键不可更新
* 二级索引访问需要两次索引查找  

**限制**  
* 只有InnoDB才有聚簇索引,MyISAM没有
* 每个表只能有一个聚簇索引，因为物理存储排序方式只有一种
* 主键尽量选择有序的顺序id
---
2.二级索引(辅助索引，非聚簇索引)  
以其他列的大小作为排序规则，多建几颗B+树，叶子节点只存放c2和c1两个列，如果要找完整的记录就要回表，通过c2列的值缺点要查找记录的主键值，然后回到聚簇索引B+树查找完整的数据  
---
3.联合索引(也是非聚簇索引)  
每条目录项记录由c2、c3、页号三部分组成，首先按c2值排序，如果c2相同，则按c3值排序， B+树叶子节点里面存储的只有c2,c3,主键c1的值  
